#:import dp kivy.metrics.dp
#:import FitImage kivymd.uix.fitimage.FitImage

<LoginScreen@MDScreen>:
    name: "login"
    MDBoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(16)

        MDBoxLayout:
            orientation: "vertical"
            adaptive_height: True
            spacing: dp(6)
            MDLabel:
                text: "tourismo"
                halign: "center"
                font_style: "H4"
                theme_text_color: "Custom"
                text_color: app.theme_cls.primary_color
                size_hint_y: None
                height: dp(56)
            MDLabel:
                text: "Zaloguj się, aby odkrywać"
                halign: "center"
                theme_text_color: "Secondary"
                size_hint_y: None
                height: dp(24)

        MDCard:
            style: "elevated"
            radius: [12, 12, 12, 12]
            padding: dp(16)
            spacing: dp(12)
            orientation: "vertical"
            MDTextField:
                id: email
                hint_text: "E-mail"
                text: ""
                size_hint_y: None
                height: dp(56)
                icon_left: "email-outline"
            MDTextField:
                id: password
                hint_text: "Hasło"
                password: True
                size_hint_y: None
                height: dp(56)
                icon_left: "lock-outline"

            MDRaisedButton:
                text: "Zaloguj"
                md_bg_color: app.theme_cls.primary_color
                on_release: app.do_login(email.text, password.text)

            MDTextButton:
                text: "Nie masz konta? Zarejestruj się"
                on_release: app.change_screen("register")
                theme_text_color: "Custom"
                text_color: app.theme_cls.primary_color


<RegisterScreen@MDScreen>:
    name: "register"
    MDBoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(16)

        MDTopAppBar:
            title: "Rejestracja"
            elevation: 0
            left_action_items: [["arrow-left", lambda x: app.change_screen("login")]]

        MDCard:
            style: "elevated"
            radius: [12, 12, 12, 12]
            padding: dp(16)
            spacing: dp(12)
            orientation: "vertical"
            MDTextField:
                id: remail
                hint_text: "E-mail"
                size_hint_y: None
                height: dp(56)
                icon_left: "email-outline"
            MDTextField:
                id: rpassword
                hint_text: "Hasło"
                password: True
                size_hint_y: None
                height: dp(56)
                icon_left: "lock-outline"
            MDRaisedButton:
                text: "Utwórz konto"
                md_bg_color: app.theme_cls.primary_color
                on_release: app.do_register(remail.text, rpassword.text)


<FeedScreen@MDScreen>:
    name: "feed"
    MDBoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "Odkrywaj"
            left_action_items: [["logout", lambda x: app.change_screen("login")]]
            right_action_items: [["plus", lambda x: app.change_screen("newpost")]]
            elevation: 0

        MDBoxLayout:
            adaptive_height: True
            padding: dp(16), dp(8)
            MDLabel:
                text: app.state_email if app.state_email else "—"
                theme_text_color: "Secondary"

        ScrollView:
            MDGridLayout:
                id: grid
                cols: 2
                padding: dp(12)
                spacing: dp(12)
                adaptive_height: True

        MDFloatingActionButton:
            icon: "plus"
            md_bg_color: app.theme_cls.primary_color
            pos_hint: {"center_x": .9, "center_y": .08}
            on_release: app.change_screen("newpost")


<NewPostScreen@MDScreen>:
    # zakładam, że w main.py masz klasę NewPostScreen z atrybutami:
    # photo_path (str), coords (str) oraz metodami open_camera(), get_location(), publish()
    name: "newpost"
    MDBoxLayout:
        orientation: "vertical"
        padding: dp(16)
        spacing: dp(12)

        MDTopAppBar:
            title: "Nowy post"
            elevation: 0
            left_action_items: [["arrow-left", lambda x: app.change_screen("feed")]]

        MDCard:
            style: "elevated"
            radius: [12, 12, 12, 12]
            padding: dp(12)
            spacing: dp(12)
            orientation: "vertical"
            size_hint_y: None
            height: dp(280)

            FitImage:
                source: root.photo_path if root.photo_path else ""
                radius: [10, 10, 10, 10]
                size_hint_y: None
                height: dp(180)

            MDBoxLayout:
                spacing: dp(8)
                MDRaisedButton:
                    text: "Zrób zdjęcie"
                    md_bg_color: app.theme_cls.primary_color
                    on_release: root.open_camera()
                MDRaisedButton:
                    text: "Lokalizacja"
                    on_release: root.get_location()

            MDLabel:
                text: "Pozycja: " + (root.coords if root.coords else "—")
                theme_text_color: "Secondary"
                size_hint_y: None
                height: dp(24)

        Widget:

        MDRaisedButton:
            text: "Opublikuj"
            md_bg_color: app.theme_cls.primary_color
            on_release: root.publish()


<Root@MDScreenManager>:
    LoginScreen:
    RegisterScreen:
    FeedScreen:
    NewPostScreen:


Root:
